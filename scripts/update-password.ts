import { prisma } from '../lib/prisma'
import bcrypt from 'bcryptjs'

/**
 * Script para actualizar la contrase√±a de un usuario
 * 
 * Uso:
 *   npm run update-password <email> <nueva-contrase√±a>
 * 
 * Ejemplo:
 *   npm run update-password admin@seminario.com Admin123
 */
async function main() {
  const email = process.argv[2]
  const password = process.argv[3]

  if (!email || !password) {
    console.error('‚ùå Error: Debes proporcionar email y contrase√±a')
    console.log('Uso: npm run update-password <email> <contrase√±a>')
    console.log('Ejemplo: npm run update-password admin@seminario.com Admin123')
    process.exit(1)
  }

  try {
    // Verificar si el usuario existe
    const existingUser = await prisma.user.findUnique({
      where: { email }
    })

    if (!existingUser) {
      console.error(`‚ùå Error: No se encontr√≥ un usuario con el email "${email}"`)
      process.exit(1)
    }

    // Hashear la nueva contrase√±a
    const hashedPassword = await bcrypt.hash(password, 10)

    // Actualizar la contrase√±a
    const user = await prisma.user.update({
      where: { email },
      data: {
        password: hashedPassword,
        approved: true, // Asegurar que est√© aprobado
      },
      select: {
        id: true,
        email: true,
        name: true,
        approved: true,
        isAdmin: true,
      }
    })

    console.log('‚úÖ Contrase√±a actualizada exitosamente:')
    console.log(`   Email: ${user.email}`)
    console.log(`   Nombre: ${user.name || 'N/A'}`)
    console.log(`   ID: ${user.id}`)
    console.log(`   Aprobado: ${user.approved ? '‚úÖ S√≠' : '‚ùå No'}`)
    console.log(`   Administrador: ${user.isAdmin ? '‚úÖ S√≠' : '‚ùå No'}`)
    console.log('\nüí° Ahora puedes iniciar sesi√≥n con la nueva contrase√±a.')
  } catch (error) {
    console.error('‚ùå Error al actualizar contrase√±a:', error)
    process.exit(1)
  } finally {
    await prisma.$disconnect()
  }
}

main()

