<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>La Pregunta del Milagro - Pr√°ctica Guiada</title>
    <style>
        :root {
            --bg-primary: #FAF9F7;
            --bg-secondary: #F5F4F0;
            --text-primary: #1A1915;
            --text-secondary: #706F6C;
            --text-muted: #9B9A97;
            --border-color: #E5E4E0;
            --card-bg: #FFFFFF;
            --accent: #DA7756;
            --accent-light: rgba(218, 119, 86, 0.1);
            --success: #2ca58d;
            --success-light: rgba(44, 165, 141, 0.1);
            --purple: #8B5CF6;
            --purple-light: rgba(139, 92, 246, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            color: var(--accent);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 0;
        }

        .back-btn svg {
            width: 20px;
            height: 20px;
        }

        .header-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .info-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }

        .info-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            text-align: center;
        }

        /* Miracle Circle */
        .miracle-circle {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: var(--card-bg);
            box-shadow: 0 0 60px rgba(0,0,0,0.04), 0 0 100px rgba(0,0,0,0.02);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            margin-bottom: 32px;
            transition: all 4s ease-in-out;
        }

        .miracle-circle.playing {
            animation: glow 6s ease-in-out infinite;
        }

        .miracle-circle.dialog {
            background: linear-gradient(135deg, var(--purple-light) 0%, var(--card-bg) 100%);
        }

        .miracle-circle.dialog.playing {
            animation: glowPurple 6s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 60px rgba(0,0,0,0.04), 0 0 100px rgba(0,0,0,0.02);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 80px rgba(218, 119, 86, 0.15), 0 0 120px rgba(218, 119, 86, 0.08);
            }
        }

        @keyframes glowPurple {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 60px rgba(0,0,0,0.04), 0 0 100px rgba(0,0,0,0.02);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 80px rgba(139, 92, 246, 0.15), 0 0 120px rgba(139, 92, 246, 0.08);
            }
        }

        .circle-icon {
            width: 48px;
            height: 48px;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .miracle-circle.dialog .circle-icon {
            color: var(--purple);
        }

        .circle-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .circle-subtext {
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Time Display */
        .time-display {
            font-size: 32px;
            font-weight: 300;
            color: var(--text-primary);
            font-variant-numeric: tabular-nums;
            margin-bottom: 16px;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            max-width: 300px;
            margin-bottom: 8px;
        }

        .progress-bar-bg {
            width: 100%;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
            cursor: pointer;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--success));
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-bar-fill.dialog {
            background: linear-gradient(90deg, var(--purple), var(--success));
        }

        .time-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 300px;
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Controls */
        .controls-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            padding: 24px;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .control-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-btn svg {
            width: 24px;
            height: 24px;
        }

        .control-btn.secondary {
            width: 52px;
            height: 52px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        .control-btn.secondary:active {
            transform: scale(0.95);
        }

        .control-btn.primary {
            width: 76px;
            height: 76px;
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 24px rgba(218, 119, 86, 0.35);
        }

        .control-btn.primary.dialog {
            background: var(--purple);
            box-shadow: 0 4px 24px rgba(139, 92, 246, 0.35);
        }

        .control-btn.primary:active {
            transform: scale(0.95);
        }

        .control-btn.primary svg {
            width: 32px;
            height: 32px;
        }

        /* Start Screen */
        .start-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            text-align: center;
        }

        .start-icon {
            width: 100px;
            height: 100px;
            background: var(--accent-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
        }

        .start-icon svg {
            width: 48px;
            height: 48px;
            color: var(--accent);
        }

        .start-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .start-description {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
            max-width: 320px;
            margin-bottom: 32px;
        }

        /* Mode Selection */
        .mode-selection {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 320px;
            margin-bottom: 24px;
        }

        .mode-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .mode-card:hover {
            border-color: var(--accent);
        }

        .mode-card.selected {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .mode-card.dialog.selected {
            border-color: var(--purple);
            background: var(--purple-light);
        }

        .mode-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .mode-card:first-child .mode-icon {
            background: var(--accent-light);
            color: var(--accent);
        }

        .mode-card:last-child .mode-icon {
            background: var(--purple-light);
            color: var(--purple);
        }

        .mode-icon svg {
            width: 24px;
            height: 24px;
        }

        .mode-info h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .mode-info p {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .start-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 48px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(218, 119, 86, 0.3);
            transition: all 0.2s ease;
        }

        .start-btn.dialog {
            background: var(--purple);
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
        }

        .start-btn:active {
            transform: scale(0.98);
        }

        .start-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Player Screen */
        .player-screen {
            display: none;
            flex-direction: column;
            flex: 1;
        }

        .player-screen.visible {
            display: flex;
        }

        /* Completion Screen */
        .completion-screen {
            flex: 1;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            text-align: center;
        }

        .completion-screen.visible {
            display: flex;
        }

        .completion-icon {
            width: 100px;
            height: 100px;
            background: var(--success-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .completion-icon svg {
            width: 48px;
            height: 48px;
            color: var(--success);
        }

        .completion-title {
            font-size: 26px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .completion-text {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
            max-width: 300px;
            margin-bottom: 32px;
        }

        .completion-btn {
            padding: 16px 48px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(44, 165, 141, 0.3);
        }

        /* Info Panel */
        .info-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .info-panel.visible {
            opacity: 1;
            visibility: visible;
        }

        .info-content {
            background: var(--card-bg);
            border-radius: 24px 24px 0 0;
            padding: 24px;
            padding-bottom: calc(24px + env(safe-area-inset-bottom));
            width: 100%;
            max-width: 500px;
            max-height: 70vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .info-panel.visible .info-content {
            transform: translateY(0);
        }

        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .info-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .close-btn {
            background: var(--bg-secondary);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .close-btn svg {
            width: 18px;
            height: 18px;
            color: var(--text-secondary);
        }

        .info-section {
            margin-bottom: 16px;
        }

        .info-section h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .info-section p, .info-section li {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .info-section ul {
            padding-left: 18px;
        }

        .info-section li {
            margin-bottom: 4px;
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Hidden Audio Elements -->
    <audio id="audioGuide" preload="auto">
        <source src="https://pub-5117fbee94844f5a8a08f061ad7ff61c.r2.dev/La%20pregunta%20del%20milagro/Audio%20la%20pregunta%20del%20milagro%20gemini.wav" type="audio/wav">
    </audio>
    <audio id="audioDialog" preload="auto">
        <source src="https://pub-5117fbee94844f5a8a08f061ad7ff61c.r2.dev/La%20pregunta%20del%20milagro/audio%20dialogo%20la%20pregunta%20del%20milagro.wav" type="audio/wav">
    </audio>

    <!-- Header -->
    <header class="header">
        <button class="back-btn" onclick="handleBack()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            <span>Volver</span>
        </button>
        <span class="header-title">Pregunta del Milagro</span>
        <button class="info-btn" onclick="toggleInfo()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4"/>
                <path d="M12 8h.01"/>
            </svg>
        </button>
    </header>

    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
        <div class="start-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                <path d="M19 3v4"/>
                <path d="M21 5h-4"/>
            </svg>
        </div>
        <h1 class="start-title">La Pregunta del Milagro</h1>
        <p class="start-description">
            Elige el tipo de audio que quieres escuchar
        </p>

        <div class="mode-selection">
            <div class="mode-card selected" id="modeGuide" onclick="selectMode('guide')">
                <div class="mode-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 20h9"/>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                    </svg>
                </div>
                <div class="mode-info">
                    <h3>Guia para Terapeuta</h3>
                    <p>Instrucciones paso a paso para aplicar la tecnica</p>
                </div>
            </div>
            <div class="mode-card dialog" id="modeDialog" onclick="selectMode('dialog')">
                <div class="mode-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                </div>
                <div class="mode-info">
                    <h3>Ejemplo de Sesion</h3>
                    <p>Dialogo entre terapeuta y cliente</p>
                </div>
            </div>
        </div>

        <button class="start-btn" id="startBtn" onclick="startSession()">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"/>
            </svg>
            Comenzar
        </button>
    </div>

    <!-- Player Screen -->
    <div class="player-screen" id="playerScreen">
        <div class="main-content">
            <div class="miracle-circle" id="miracleCircle">
                <svg class="circle-icon" id="circleIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                    <path d="M19 3v4"/>
                    <path d="M21 5h-4"/>
                </svg>
                <span class="circle-text" id="circleText">Escuchando</span>
                <span class="circle-subtext" id="circleSubtext">Imagina tu milagro</span>
            </div>

            <div class="time-display" id="timeDisplay">0:00</div>

            <div class="progress-container">
                <div class="progress-bar-bg" onclick="seekAudio(event)" id="progressBarBg">
                    <div class="progress-bar-fill" id="progressBar"></div>
                </div>
            </div>
            <div class="time-labels">
                <span id="currentTime">0:00</span>
                <span id="totalTime">0:00</span>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls-bar">
            <button class="control-btn secondary" onclick="rewind()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                    <path d="M3 3v5h5"/>
                </svg>
            </button>
            <button class="control-btn primary" id="playPauseBtn" onclick="togglePlayPause()">
                <svg id="pauseIcon" viewBox="0 0 24 24" fill="currentColor">
                    <rect x="6" y="4" width="4" height="16" rx="1"/>
                    <rect x="14" y="4" width="4" height="16" rx="1"/>
                </svg>
                <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor" class="hidden">
                    <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
            </button>
            <button class="control-btn secondary" onclick="forward()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12a9 9 0 1 1-9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                    <path d="M21 3v5h-5"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Completion Screen -->
    <div class="completion-screen" id="completionScreen">
        <div class="completion-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        </div>
        <h2 class="completion-title">Practica Completa</h2>
        <p class="completion-text">
            Has explorado tu dia despues del milagro. Recuerda: ya tienes los recursos, aunque no siempre los veas.
        </p>
        <button class="completion-btn" onclick="resetToStart()">Terminar</button>
    </div>

    <!-- Info Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-content">
            <div class="info-header">
                <h2>Sobre La Pregunta del Milagro</h2>
                <button class="close-btn" onclick="toggleInfo()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="info-section">
                <h3>Que es?</h3>
                <p>Tecnica desarrollada por Steve de Shazer e Insoo Kim Berg. Te ayuda a visualizar tu futuro ideal y descubrir que ya tienes recursos para lograrlo.</p>
            </div>
            <div class="info-section">
                <h3>Por que funciona</h3>
                <ul>
                    <li>Activa la Red de Modo Predeterminado del cerebro</li>
                    <li>Crea nuevas redes neuronales del futuro deseado</li>
                    <li>Evita las defensas del "como" y accede a soluciones</li>
                    <li>Revela excepciones: momentos en que ya lo lograste</li>
                </ul>
            </div>
            <div class="info-section">
                <h3>Los dos modos</h3>
                <ul>
                    <li><strong>Guia para Terapeuta:</strong> Instrucciones detalladas para aplicar la tecnica con un cliente</li>
                    <li><strong>Ejemplo de Sesion:</strong> Dialogo completo entre terapeuta y cliente para ver como fluye la conversacion</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Elements
        const audioGuide = document.getElementById('audioGuide');
        const audioDialog = document.getElementById('audioDialog');
        const progressBar = document.getElementById('progressBar');
        const timeDisplay = document.getElementById('timeDisplay');
        const currentTimeLabel = document.getElementById('currentTime');
        const totalTimeLabel = document.getElementById('totalTime');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const miracleCircle = document.getElementById('miracleCircle');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const startBtn = document.getElementById('startBtn');

        let currentMode = 'guide';
        let audio = audioGuide;
        let isPlaying = false;

        // Select mode
        function selectMode(mode) {
            currentMode = mode;

            // Update UI
            document.getElementById('modeGuide').classList.toggle('selected', mode === 'guide');
            document.getElementById('modeDialog').classList.toggle('selected', mode === 'dialog');

            // Update button style
            startBtn.classList.toggle('dialog', mode === 'dialog');

            // Set audio source
            audio = mode === 'guide' ? audioGuide : audioDialog;
        }

        // Format time (seconds to M:SS)
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Update progress bar and time
        function updateProgress() {
            if (audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = `${percent}%`;
                timeDisplay.textContent = formatTime(audio.currentTime);
                currentTimeLabel.textContent = formatTime(audio.currentTime);
            }
        }

        // Setup audio listeners for both audios
        function setupAudioListeners(audioElement) {
            audioElement.addEventListener('loadedmetadata', () => {
                if (audioElement === audio) {
                    totalTimeLabel.textContent = formatTime(audioElement.duration);
                }
            });

            audioElement.addEventListener('timeupdate', () => {
                if (audioElement === audio) {
                    updateProgress();
                }
            });

            audioElement.addEventListener('ended', () => {
                if (audioElement === audio) {
                    isPlaying = false;
                    updatePlayPauseButton();
                    miracleCircle.classList.remove('playing');
                    showCompletion();
                }
            });

            audioElement.addEventListener('play', () => {
                if (audioElement === audio) {
                    isPlaying = true;
                    updatePlayPauseButton();
                    miracleCircle.classList.add('playing');
                }
            });

            audioElement.addEventListener('pause', () => {
                if (audioElement === audio) {
                    isPlaying = false;
                    updatePlayPauseButton();
                    miracleCircle.classList.remove('playing');
                }
            });
        }

        setupAudioListeners(audioGuide);
        setupAudioListeners(audioDialog);

        // Start session
        function startSession() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('playerScreen').classList.add('visible');

            // Update player UI based on mode
            if (currentMode === 'dialog') {
                miracleCircle.classList.add('dialog');
                progressBar.classList.add('dialog');
                playPauseBtn.classList.add('dialog');
                document.getElementById('circleSubtext').textContent = 'Escucha el dialogo';
            } else {
                miracleCircle.classList.remove('dialog');
                progressBar.classList.remove('dialog');
                playPauseBtn.classList.remove('dialog');
                document.getElementById('circleSubtext').textContent = 'Imagina tu milagro';
            }

            // Update total time for selected audio
            totalTimeLabel.textContent = formatTime(audio.duration);

            audio.play();
        }

        // Toggle play/pause
        function togglePlayPause() {
            if (isPlaying) {
                audio.pause();
            } else {
                audio.play();
            }
        }

        // Update play/pause button icon
        function updatePlayPauseButton() {
            playIcon.classList.toggle('hidden', isPlaying);
            pauseIcon.classList.toggle('hidden', !isPlaying);
        }

        // Seek audio
        function seekAudio(event) {
            const progressBarBg = document.getElementById('progressBarBg');
            const rect = progressBarBg.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            audio.currentTime = percent * audio.duration;
        }

        // Rewind 15 seconds
        function rewind() {
            audio.currentTime = Math.max(0, audio.currentTime - 15);
        }

        // Forward 15 seconds
        function forward() {
            audio.currentTime = Math.min(audio.duration, audio.currentTime + 15);
        }

        // Show completion screen
        function showCompletion() {
            document.getElementById('playerScreen').classList.remove('visible');
            document.getElementById('completionScreen').classList.add('visible');
        }

        // Reset to start
        function resetToStart() {
            document.getElementById('completionScreen').classList.remove('visible');
            document.getElementById('startScreen').classList.remove('hidden');

            // Reset both audios
            audioGuide.currentTime = 0;
            audioDialog.currentTime = 0;

            progressBar.style.width = '0%';
            timeDisplay.textContent = '0:00';
            currentTimeLabel.textContent = '0:00';

            // Reset mode selection UI
            miracleCircle.classList.remove('dialog', 'playing');
            progressBar.classList.remove('dialog');
            playPauseBtn.classList.remove('dialog');
        }

        // Toggle info panel
        function toggleInfo() {
            document.getElementById('infoPanel').classList.toggle('visible');
        }

        // Handle back button
        function handleBack() {
            audioGuide.pause();
            audioDialog.pause();
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = '/apps';
            }
        }

        // Close info panel when clicking outside
        document.getElementById('infoPanel').addEventListener('click', function(e) {
            if (e.target === this) {
                toggleInfo();
            }
        });
    </script>
</body>
</html>
